<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0 minimal-ui"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <title>더리얼마케팅 전자영수증</title>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <link rel="stylesheet" media="all" href="../code/layout.css" />
    <link rel="stylesheet" media="all" href="../code/common.css" />

    <!-- main -->
	<script src="../code/jquery.bxslider.min.js"></script>
    <link href="../code/jquery.bxslider.css" rel="stylesheet" />
    
    <!-- tab -->
	<script type='text/javascript' src='../code/tabs.js'></script>
    
    <!-- scroll -->
	<script src="../code/fm.scrollator.jquery.js"></script>
	<link rel="stylesheet" href="../code/fm.scrollator.jquery.css" />
    
    <!-- Path to your custom app styles-->
    <link rel="stylesheet" href="../css/my-app.css">
    
	<script src="../code/common.js"></script>
    
</head>

<body>



    <!-- Status bar overlay for fullscreen mode-->
    <div class="statusbar-overlay"></div>


    <!-- Panels overlay-->
    <div class="panel-overlay"></div>


    <div class="panel panel-left panel-reveal">
    
    	<div class="profile_box">
        	<!-- <div class="pf_photo" style="background:url(common/profile.jpg) no-repeat center;"></div> -->
            
            <div class="pf_txt">
            	<h2>김종현</h2>
                <p>쿠폰 <span>0</span>개</p>
                <p>포인트 <span>200</span>p</p>
            </div>
            <hr>
        </div>
        
        <div class="left_menu">
        </div>

    </div>
    
    <div class="views">
		<div class="view view-main">
        
            <div class="navbar top_menu">
                <div data-page="index" class="navbar-inner">
                
                    <div class="left">
                    <a href="#" class="link icon-only open-panel"> <i class="icon icon-bars"></i></a>
                    </div>
                    <div class="center sliding alen_logo"><img src="../common/logo.png"></div>

                </div>
                
                <div data-page="receipt_details" class="navbar-inner cached">
                <div class="left sliding"><a href="#" class="back link"> <i class="icon icon-back"></i><span>Back</span></a></div>
                <div class="center sliding">영수증 상세 내역</div>
                </div>
                
                
                <div data-page="agree01" class="navbar-inner cached">
                <div class="left sliding"><a href="#" class="back link"> <i class="icon icon-back"></i><span>Back</span></a></div>
                <div class="center sliding">개인정보 수집이용취급위탁 동의</div>
                </div>
                
                
                <div data-page="agree03" class="navbar-inner cached">
                <div class="left sliding"><a href="#" class="back link"> <i class="icon icon-back"></i><span>Back</span></a></div>
                <div class="center sliding">본인확인서비스 이용약관</div>
                </div>
                
                
            </div>
            


			<div class="pages navbar-through toolbar-through">
                <div data-page="index" class="page">
                    <div class="page-content">

					<div class="latest_box alen_outbox">

                    	<div class="latest_content" >
                        	<h2>최근사용내역</h2>
                        	<ul id = "receiptData">
                            </ul>
                        </div>
                    </div>
                    
                    <div class="foot_info">
                    
                    	<div class="foot_box">
                        	<div class="foot_btn alen_outbox">
                            <a href="#agree03">이용약관</a>
                            </div>
                            
                        	<div class="foot_btn alen_outbox">
                            <a href="#agree01">개인정보 취급방침</a>
                            </div>
                            
                        	<div class="foot_btn alen_outbox">
                            <a href="#">고객센터</a>
                            </div>
                            
                            
                            <hr>
                        </div>
<p>
(주)이베이 코리아   |   대표이사 : 변광윤<br>
사업자등록번호 : 220-81-83676   |   통신판매업신고 강남 10630호<br>
서울시 강남구 테헤란로 152 (역삼동 강남파이낸스센터)<br>
이메일 :information@corp.auction.co.kr<br>
고객센터 :1588-0184(오전9시~오후6시,토요일/공휴일휴무<br>
</p>

<p class="copytxt">Copyrightⓒnoname Co,.All rights reserved</p>
                    </div>
                    
                    
                    </div>
                </div>
                

                <div data-page="receipt_details" class="page cached">
                    <div class="page-content">
                        <div class="content-block">
                        
						<div class="receipt_box">
                        	<div class="receipt_inbox" id ="detailRecData">
                                
                            </div>
                        </div>
                        
                        <div class="latest_btnbox" onClick="location.href=''">
                            <div class="latest_btn">이메일 보내기</div>
                        </div>
                        
                        
                        
                        </div>
                    </div>
                </div>
                
                
                
                <div data-page="agree01" class="page cached">
                    <div class="page-content agree_acon">
                        <div class="content-block">
						<iframe src="agree01.html" frameborder="0" width="100%" height="100%"></iframe>
                        </div>
                    </div>
                </div>
                
                
                <div data-page="agree03" class="page cached">
                    <div class="page-content agree_acon">
                        <div class="content-block">
						<iframe src="agree03.html" frameborder="0" width="100%" height="100%"></iframe>
                        </div>
                    </div>
                </div>
                
			</div>
            
            
            
            

		</div>
    </div>
<div id="div_ajax_load_image">
    <img src="../common/log_img.png" />
</div> 


<script type="text/javascript" src="../js/framework7.js"></script>

<script type="text/javascript" src="../js/my-app.js"></script>

<input value="activate scrollator" id="activate_scrollator4" type="button"  style="display:none;">

<script type="text/javascript">
	var request = new Request();
	var telNo = request.getParameter('telNo');
	var barcodeNo = "";
	var dtlSeq = "";
	var seq = "";
	$(document).ready(function(){
		latestData();
		commonUserData();
		$(document).on('click','[name="receiptDetail"]',function(){
			seq = $(this).attr('id');
			seq = seq.replace("seq","");
			dtlSeq = seq;
			barcodeNo = $("#barcodeNo"+seq).val()
			latestDetailData(seq);
		});				
		
		
	})

	
	
	function latestData(){
	    $.ajax({
	        type: "post",
	        url : commonIp()+"/theReal/receipt/latestData.do",
	        data: {
	        	telNo  	: telNo
	        },
	        success: fn_latestData,

	        
	        beforeSend: function () {
	              var width = 0;
	              var height = 0;
	              var left = 0;
	              var top = 0;
	              width = 50;
	              height = 50;

	              top = ( $(window).height() - height ) / 2 + $(window).scrollTop();
	              left = ( $(window).width() - width ) / 2 + $(window).scrollLeft();
	 console.log($("#div_ajax_load_image").length)
	              if($("#div_ajax_load_image").length != 0) {
	                     $("#div_ajax_load_image").css({
	                            "top": "100px",
	                            "left": "100px"
	                     });
	                     $("#div_ajax_load_image").show();
	              }
	              else {
	                     $('body').append('<div id="div_ajax_load_image" style="position:absolute; top:' + top + 'px; left:' + left + 'px; width:' + width + 'px; height:' + height + 'px; z-index:9999; background:#f0f0f0; filter:alpha(opacity=50); opacity:alpha*0.5; margin:auto; padding:0; "><img src="file://D:\\temp\\ajax_loader.gif" style="width:50px; height:50px;"></div>');
	              }
	       },	        
	        
	        
	        error: whenError
    	});				
	};
	
	function latestDetailData(seq){
	    $.ajax({
	        type: "post",
	        url : commonIp()+"/theReal/receipt/latestDetailData.do",
	        data: {
	        	telNo  	: telNo,
	        	salesBarcode  	: barcodeNo
	        },
	        success: fn_latestDetailData,
	        error: whenError
		});				
	};
	
	function fn_latestData(resdata){
		var str = "";
		var resultData = resdata.resultMap;
		var cardCashDiv = "";
		
		$("#receiptData").empty();
		
		resultCnt = resultData.length;
		
		if(resultData.length>0){
			for(var i=0; i<resultCnt; i++){
				if(resultData[i].CARD_ICOM == ""){
					cardCashDiv = "현금"		
				}else{
					cardCashDiv = resultData[i].CARD_ICOM;	
				}
				
				str += '<li>';
				str += '<input type="hidden" value = "'+resultData[i].SALES_BARCODE+'" id="barcodeNo'+resultData[i].SEQ+'">';
				str += '<input type="hidden" value = "'+resultData[i].SHOP_NAME+'" id="shopName'+resultData[i].SEQ+'">';
				str += '<input type="hidden" value = "'+resultData[i].SHOP_ADDR+'" id="shopAddr'+resultData[i].SEQ+'">';
				str += '<input type="hidden" value = "'+resultData[i].SHOP_BIZNO+'" id="shopBizNo'+resultData[i].SEQ+'">';
				str += '<input type="hidden" value = "'+resultData[i].SHOP_CEO+'" id="shopCeo'+resultData[i].SEQ+'">';
				str += '<input type="hidden" value = "'+resultData[i].SHOP_TEL_NUM+'" id="shopTelNum'+resultData[i].SEQ+'">';
				str += '<input type="hidden" value = "'+resultData[i].SHOP_CASHIER+'" id="shopCashier'+resultData[i].SEQ+'">';
				str += '<input type="hidden" value = "'+resultData[i].SALES_DATE+'" id="salesDate'+resultData[i].SEQ+'">';
				str += '<input type="hidden" value = "'+resultData[i].CARD_APP_NO+'" id="cardAppNo'+resultData[i].SEQ+'">';
				str += '<input type="hidden" value = "'+resultData[i].CARD_NO+'" id="cardNo'+resultData[i].SEQ+'">';
				str += '<input type="hidden" value = "'+resultData[i].CARD_ICOM+'" id="cardICom'+resultData[i].SEQ+'">';
				str += '<input type="hidden" value = "'+resultData[i].CARD_INSTALLMENT+'" id="cardInstall'+resultData[i].SEQ+'">';
				//전체부가세합
				str += '<input type="hidden" value = "'+resultData[i].SALES_SUM_TAX_AMT+'" id="sumTaxAmt'+resultData[i].SEQ+'">';
				//면세물품가액
				str += '<input type="hidden" value = "'+resultData[i].SALES_SUM_DF_AMT+'" id="sumDfAmt'+resultData[i].SEQ+'">';
				//과세물품가액
				str += '<input type="hidden" value = "'+resultData[i].SALES_SUM_FP_AMT+'" id="sumFpAmt'+resultData[i].SEQ+'">';
				//전체판매금액
				str += '<input type="hidden" value = "'+resultData[i].SALES_SUM_AL_AMT+'" id="sumAlAmt'+resultData[i].SEQ+'">';
				//전체 결제금액
				str += '<input type="hidden" value = "'+resultData[i].SALES_PAID_AMT+'" id="sumPaidAmt'+resultData[i].SEQ+'">';
				str += '<a href="#receipt_details" name="receiptDetail" id="seq'+resultData[i].SEQ+'">';
				//str += '<a href="#" name="receiptDetail" id="seq'+i+'">';
				str += '<div class="mlat01" id="mlat01'+resultData[i].SEQ+'">'+resultData[i].SALES_PRINT_DATE+'</div>';
				str += '<div class="mlaticon" id="mlaticon'+resultData[i].SEQ+'"><span>커피</span></div>';
				str += '<div class="mlat02" id="mlat02'+resultData[i].SEQ+'">'+cardCashDiv+'</div>';
				str += '<div class="mlat03" id="mlat03'+resultData[i].SEQ+'">'+resultData[i].SHOP_NAME+'</div>';
				str += '<div class="mlat04" id="mlat04'+resultData[i].SEQ+'">'+numberWithCommas(resultData[i].SALES_SUM_AL_AMT)+'</div>';
				
				str += '<hr>';		            
				str += '</a>';		            
				str += '</li>';		            
		           
			}
		}else{
			str += '<li>';
			str += '<div>최근사용내역이 없습니다.</div>';
			str += '</li>';		  	
		}
		$("#receiptData").append(str);		
		//$("#detailRecData").empty();
	};
	
	function fn_latestDetailData(resdata){
		var str = "";
		var resultData = resdata.resultMap;
		var cardCashDtlDiv = "";
		
		$("#detailRecData").empty();
		resultCnt = resultData.length;
		
		if(resultData.length>0){
			str += ' <div class="receipt_holl">	';
			str += ' 	<div></div>             ';
			str += '     <div></div>             ';
			str += '     <div></div>             ';
			str += '     <div></div>             ';
			str += '     <div></div>             ';
			str += '     <div></div>             ';
			str += '     <div></div>             ';
			str += '     <div></div>             ';
			str += '     <div></div>             ';
			str += '     <div></div>             ';
			str += '     <hr>                    ';
			str += ' </div>					    ';
			if($("#mlat02"+dtlSeq).text() == "현금"){
				cardCashDtlDiv = "현금";
				str += '<div class="rec_half">';
				str += '	<ul>';
				str += '      <li><div>거래종류</div><div class="rec_hcon">'+cardCashDtlDiv+'</div></li>';
				str += '      <li><div>거래일자</div><div class="rec_hcon">'+$("#mlat01"+dtlSeq).text()+'</div></li>';
				str += '      <hr>';
				str += '    </ul>';
				str += '</div>';			
			}else{
				str += '<div class="rec_txt01"><span>카드종류 : </span>'+	$("#cardICom"+dtlSeq).val()+'</div>';
				str += '<div class="rec_txt01"><span>카드번호 : </span>'+	$("#cardNo"+dtlSeq).val()+'</div>';		
				cardCashDtlDiv = "신용결제";
				str += '<div class="rec_half">';
				str += '	<ul>';
				str += '      <li><div>거래종류</div><div class="rec_hcon">'+cardCashDtlDiv+'</div></li>';
				str += '      <li><div>거래일자</div><div class="rec_hcon">'+$("#mlat01"+dtlSeq).text()+'</div></li>';
				str += '      <li><div>승인번호</div><div class="rec_hcon">'+	$("#cardAppNo"+dtlSeq).val()+'</div></li>';
				str += '      <li><div>할부개월수</div><div class="rec_hcon">'+	$("#cardInstall"+dtlSeq).val()+'</div></li>';
				str += '      <hr>';
				str += '    </ul>';
				str += '</div>';			
			}
			
			//str += '<div class="rec_date"><span id = "recDate">'+$("#mlat01"+dtlSeq).text()+'</span> <span class="rec_right" id="recRight">'+barcodeNo+'</span><hr></div>';
			str += '<div class="rec_table">';
			str += '<ul class="rec_tabletitle">';
			str += '<li class="rec_mlat01">상품명</li>';
			str += '<li class="rec_mlat02">단가</li>';
			str += '<li class="rec_mlat03">수량</li>';
			str += '<li class="rec_mlat04">금액</li>';
			str += '<hr>';
			str += '</ul>';		
			
			for(var i=0; i<resultCnt; i++){
	            str += '<ul>';
	            str += '  <li class="rec_mlat01" id="dtlGoods'+i+'">'+resultData[i].SALES_PNAME+'</li>';
	            str += '  <li class="rec_mlat02" id="dtlPPrice'+i+'">'+numberWithCommas(resultData[i].SALES_PPRICE)+'</li>';
	            str += '  <li class="rec_mlat03" id="dtlQty'+i+'">'+resultData[i].SALES_QTY+'</li>';
	            str += '  <li class="rec_mlat04" id="dtlSlAmt'+i+'">'+numberWithCommas(resultData[i].SALES_SL_AMT)+'</li>';
	            str += '  <hr>';
	            str += '</ul>';				
		           
			}
			str += '</div>';
			

			str += '<div class="rec_half">';
			str += '	<ul>';
			str += '      <li><div>부가세</div><div class="rec_hcon">'+numberWithCommas($("#sumTaxAmt"+dtlSeq).val())+'</div></li>';
			str += '      <li><div>합 계</div><div class="rec_hcon">'+numberWithCommas($("#sumAlAmt"+dtlSeq).val())+'</div></li>';
			str += '      <li><div>결제금액</div><div class="rec_hcon">'+numberWithCommas($("#sumPaidAmt"+dtlSeq).val())+'</div></li>';
			str += '      <li><div>반환금액</div><div class="rec_hcon">'+($("#sumPaidAmt"+dtlSeq).val()-$("#sumAlAmt"+dtlSeq).val())+'</div></li>';
			str += '      <hr>';
			str += '    </ul>';
			str += '</div>';
			str += '<div class="rec_half">';
			str += '	<ul>';
			str += '      <li><div>업체명</div><div class="rec_hcon">'+$("#shopName"+dtlSeq).val()+'</div></li>';
			str += '      <li><div>대표자</div><div class="rec_hcon">'+$("#shopCeo"+dtlSeq).val()+'</div></li>';
			str += '      <li class="rec_full"><div>가맹점주소</div><div class="rec_hcon">'+$("#shopAddr"+dtlSeq).val()+'</div></li>';
			str += '      <li class="rec_full"><div>문의연락처</div><div class="rec_hcon">'+$("#shopTelNum"+dtlSeq).val()+'</div></li>';
			str += '      <li class="rec_full"><div>사업자번호</div><div class="rec_hcon">'+$("#shopBizNo"+dtlSeq).val()+'</div></li>';
			str += '      <hr>';
			str += '    </ul>';
			str += '</div>';			

/* 			str += '<div class="rec_table2">';
			str += '	<ul>';
			str += '    	<li class="rec_mlat05">면세물품가액</li>';
			str += '    	<li class="rec_mlat06">'+numberWithCommas($("#sumDfAmt"+dtlSeq).val())+'</li>';
			str += '        <hr>';
			str += '    </ul>';
			str += '	<ul>';
			str += '    	<li class="rec_mlat05">과세물품가액</li>';
			str += '    	<li class="rec_mlat06">'+numberWithCommas($("#sumFpAmt"+dtlSeq).val())+'</li>';
			str += '        <hr>';
			str += '    </ul>';
			str += '	<ul>';
			str += '    	<li class="rec_mlat05">부가세</li>';
			str += '    	<li class="rec_mlat06">'+numberWithCommas($("#sumTaxAmt"+dtlSeq).val())+'</li>';
			str += '        <hr>';
			str += '    </ul>';
			str += '</div>';
			str += '<div class="rec_table3">';
			str += '	<ul>';
			str += '    	<li class="rec_mlat07">합 계</li>';
			str += '    	<li class="rec_mlat08">'+numberWithCommas($("#sumAlAmt"+dtlSeq).val())+'</li>';
			str += '        <hr>';
			str += '    </ul>';
			str += '	<ul>';
			str += '    	<li class="rec_mlat07">결제금액</li>';
			str += '    	<li class="rec_mlat08">'+numberWithCommas($("#sumPaidAmt"+dtlSeq).val())+'</li>';
			str += '        <hr>';
			str += '    </ul>';
 			str += '	<ul>';
			str += '    	<li class="rec_mlat07">반환금액</li>';
			str += '    	<li class="rec_mlat08">'+($("#sumPaidAmt"+dtlSeq).val())+'</li>';
			str += '        <hr>';
			str += '    </ul>'; 
			str += '</div>';	 */	
		}
		$("#detailRecData").append(str);		
		
	};
	
	
	function fn_latestUpdateData(){
		console.log("확인여부업데이트");
	};
	
	function whenError(){
		alert("실패");
	};
	
	
</script>


</body>
</html>
